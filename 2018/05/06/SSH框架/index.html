<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、Spring1.1 Spring IOC创建对象的三种方式：IOC的定义：Inverse of  control控制反转，简单来说就是对象的使用者不是创建者,讲对象的创建和使用分离，起到解耦作用，即业务层代码只专注业务逻辑实现，用到的对象参数由外界创建，业务逻辑用接口参数接收，这样就是实现了高拓展性和隔离的设计原则。 1.Spring容器,通过Spring配置托管或者通过Spring注解,由S">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2018/05/06/SSH框架/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、Spring1.1 Spring IOC创建对象的三种方式：IOC的定义：Inverse of  control控制反转，简单来说就是对象的使用者不是创建者,讲对象的创建和使用分离，起到解耦作用，即业务层代码只专注业务逻辑实现，用到的对象参数由外界创建，业务逻辑用接口参数接收，这样就是实现了高拓展性和隔离的设计原则。 1.Spring容器,通过Spring配置托管或者通过Spring注解,由S">
<meta property="og:locale" content="default">
<meta property="og:image" content="k:/黑马培训/就业班Web阶段/25期实录资料/SSH/day44Struts2三/笔记/img/tu_2.png">
<meta property="og:updated_time" content="2018-02-14T02:51:37.437Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="一、Spring1.1 Spring IOC创建对象的三种方式：IOC的定义：Inverse of  control控制反转，简单来说就是对象的使用者不是创建者,讲对象的创建和使用分离，起到解耦作用，即业务层代码只专注业务逻辑实现，用到的对象参数由外界创建，业务逻辑用接口参数接收，这样就是实现了高拓展性和隔离的设计原则。 1.Spring容器,通过Spring配置托管或者通过Spring注解,由S">
<meta name="twitter:image" content="k:/黑马培训/就业班Web阶段/25期实录资料/SSH/day44Struts2三/笔记/img/tu_2.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-SSH框架" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/06/SSH框架/" class="article-date">
  <time datetime="2018-05-06T09:00:44.151Z" itemprop="datePublished">2018-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、Spring"><a href="#一、Spring" class="headerlink" title="一、Spring"></a>一、Spring</h1><h2 id="1-1-Spring-IOC创建对象的三种方式："><a href="#1-1-Spring-IOC创建对象的三种方式：" class="headerlink" title="1.1 Spring IOC创建对象的三种方式："></a>1.1 Spring IOC创建对象的三种方式：</h2><p>IOC的定义：Inverse of  control控制反转，简单来说就是对象的使用者不是创建者,讲对象的创建和使用分离，起到解耦作用，即业务层代码只专注业务逻辑实现，用到的对象参数由外界创建，业务逻辑用接口参数接收，这样就是实现了高拓展性和隔离的设计原则。</p>
<p>1.Spring容器,通过Spring配置<bean id="" class="">托管或者通过Spring注解,由Spring框架识别创建对象</bean></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--默认spring创建实例是单例	 </span></span><br><span class="line"><span class="comment">如果想做成多例，就使用scope="prototype"	 	</span></span><br><span class="line"><span class="comment">init-method: 生成实例的时候调用指定的方法</span></span><br><span class="line"><span class="comment">destroy-method: 销毁实例的时候调用指定的方法   ，单例下有效（关闭工厂） ， 多例看不到</span></span><br><span class="line"><span class="comment">因为单例的时候是在spring工厂创建的时候就创建了（此时默认lazy-init="false"，不是懒加载），每次请求都从工厂去拿，</span></span><br><span class="line"><span class="comment">而多例是在每次接受到请求的时候才创建，</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"us"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.UserServiceImpl"</span>  <span class="attr">scope</span>=<span class="string">"prototype"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.静态工厂模式：实际上对象还是new出来的，只不过是再另外一个工厂类中调用静态方法new出来的对象</p>
<p>3.对象工厂模式：这种模式的本质对象最终还是由Spring容器创建的,对象工厂只是起到一个中间转换的角色，表面上看对象好像是工厂直接创建的，实际创建工作都是有Spring容器创建的</p>
<h2 id="1-2-Spring-AOP底层原理-默认JDK动态代理"><a href="#1-2-Spring-AOP底层原理-默认JDK动态代理" class="headerlink" title="1.2 Spring AOP底层原理-默认JDK动态代理"></a>1.2 Spring AOP底层原理-默认JDK动态代理</h2><p>AOP的定义：Aspect Oriented Programming面向切面编程，spring中的安全，事务，日志等都是基于AOP, 默认都是JDK动态代理的方式，提高了程序的复用性。</p>
<p>###1.2.1 XML的配置方式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 要托管扩展类和被扩展类 。 托管userService  logger --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"us"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"logger"</span> <span class="attr">class</span>=<span class="string">"com.itheima.util.Logger"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--切点，值得是我们要进行扩展的目标方法--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置切入点  expression 表达式 '</span></span><br><span class="line"><span class="comment">			execution(* com.xyz.myapp.service.*.*(..))</span></span><br><span class="line"><span class="comment">			execution 固定写法</span></span><br><span class="line"><span class="comment">			第一个* 代表任意返回值</span></span><br><span class="line"><span class="comment">			com.xyz.myapp.service ： 包名</span></span><br><span class="line"><span class="comment">			第二个* 包下的任意类</span></span><br><span class="line"><span class="comment">			第三个* 类中的任意方法</span></span><br><span class="line"><span class="comment">			(..) : 任意参数，如果是指定类型参数，例如是一个String类型的参数，就写String.class</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"aa"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--logger指的是拓展类--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"logger"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 前置增强 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;aop:before method="log"  pointcut-ref="aa"/&gt; --&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 后置增强 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;aop:after-returning method="log"  pointcut-ref="aa"/&gt; --&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 最终增强： 有异常也增强 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;aop:after method="log"  pointcut-ref="aa"/&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- 环绕增强 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;aop:before method="log"  pointcut-ref="aa"/&gt;</span></span><br><span class="line"><span class="comment">		&lt;aop:after-returning method="log"  pointcut-ref="aa"/&gt; --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;aop:around method="log2" pointcut-ref="aa"/&gt; --&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 异常增强  有异常才增强--&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!--表示在被拓展对象的方法上(aa)拓展log方法,位置如上述几种--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"log"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aa"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-注解的配置方式："><a href="#1-2-2-注解的配置方式：" class="headerlink" title="1.2.2 注解的配置方式："></a>1.2.2 注解的配置方式：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 要托管扩展类和被扩展类 。 托管 logger userService --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"us"</span> <span class="attr">class</span>=<span class="string">"com.itheima.service.impl.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"logger"</span> <span class="attr">class</span>=<span class="string">"com.itheima.util.Logger"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- aop的注解有自己的开关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在扩展类上加如下注解，声明被增强的对象和增强的方法以及增强的方式。这里以在(com.itheima.service.impl.UserServiceImpl)下的所有方法为被增强对象，logger类的中方法作为增强对象为例说明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.util;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="comment">//这个logger是用来做增强的，它必须有一个注解，这个注解是 @Aspect 。 </span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line"><span class="comment">// 这个方法要用来做前置增强。</span></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"输出日志~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//========================================</span></span><br><span class="line"><span class="comment">//这里相当于对被增强对象做了一个抽取，封装为aa()方法</span></span><br><span class="line"><span class="meta">@After</span>(<span class="string">"Logger.aa()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log2</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"输出日志~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After</span>(<span class="string">"Logger.aa()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log3</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"输出日志~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aa</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-3-Spring整合Hibernate的事务配置的三种方式"><a href="#1-2-3-Spring整合Hibernate的事务配置的三种方式" class="headerlink" title="1.2.3 Spring整合Hibernate的事务配置的三种方式"></a>1.2.3 Spring整合Hibernate的事务配置的三种方式</h3><p>在hibernate中,事务的默认提交方式是手动，需要手动开启，手动提交，手动回滚</p>
<p>Spring整合事务是基于Spring的AOP技术，AOP又是基于动态代理，Spring的事务控制默认使用的是JDK动态代理，</p>
<p>可以手动修改默认方式，加如下配置即可切换到cglib的代理方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式一：编程方式</p>
<p>‘@Test</p>
<pre><code>public void testSave(){
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">	DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">	dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">	dataSource.setUrl(<span class="string">"jdbc:mysql:///stus"</span>);</span><br><span class="line">	dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">	dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//1. 创建对象</span></span><br><span class="line">	<span class="keyword">final</span> JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">	jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">	<span class="comment">//构建事务管理员</span></span><br><span class="line">	DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">	transactionManager.setDataSource(dataSource);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//1. 创建事务的模板，它里面包含了开启事务、 提交事务、 回滚事务的代码。</span></span><br><span class="line">	<span class="comment">//但是这里操作必须要有管理员才能执行</span></span><br><span class="line">	TransactionTemplate transactionTemplate = <span class="keyword">new</span> TransactionTemplate();</span><br><span class="line">	transactionTemplate.setTransactionManager(transactionManager);</span><br><span class="line">	<span class="comment">//让数据库的操作在事务里面执行。</span></span><br><span class="line">	transactionTemplate.execute(<span class="keyword">new</span> TransactionCallback&lt;Object&gt;() &#123;</span><br><span class="line">		<span class="comment">//这个方法将会在事务的范畴里面调用</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Object <span class="title">doInTransaction</span><span class="params">(TransactionStatus arg0)</span> </span>&#123;</span><br><span class="line">			</span><br><span class="line">			String sql = <span class="string">"insert into t_user values (null , ? , ? )"</span>;</span><br><span class="line">			jdbcTemplate.update(sql, <span class="string">"张三11"</span> ,<span class="string">"中粮11"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">int</span> a = <span class="number">1</span> / <span class="number">0</span> ;</span><br><span class="line">			jdbcTemplate.update(sql, <span class="string">"张三12"</span> ,<span class="string">"中粮12"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;<span class="string">'</span></span><br></pre></td></tr></table></figure>
<p>方式二：XML配置（基于AOP）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果需要用事务的话，管理员用谁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"advice01"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 到底用没有事务，由这里说了算。 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span>/&gt;</span> <span class="comment">&lt;!--  * 就代表前面的那个表达式找到的所有方法都用事务管理 </span></span><br><span class="line"><span class="comment">								如果想独立指定具体的方法就写方法名， 或者是save*</span></span><br><span class="line"><span class="comment">								--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 使用这个表达式是去找到需要用事务管理的方法 --&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.service.impl.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"aa"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 让那些方法和上面的管理员建立关系。也就知道了用上面的管理员来管理他们的事务 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"advice01"</span> <span class="attr">pointcut-ref</span>=<span class="string">"aa"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>'</span><br></pre></td></tr></table></figure>
<p>方式三：注解配置,如下配置后，在需要加事务的service上或者其方法上加@Transactional</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 指定注解的事务，用的管理员是谁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span>'</span><br></pre></td></tr></table></figure>
<h2 id="1-3-Spring工厂的提前创建"><a href="#1-3-Spring工厂的提前创建" class="headerlink" title="1.3 Spring工厂的提前创建"></a>1.3 Spring工厂的提前创建</h2><p>特点：单例，全局只有一个；提前创建，提高用户体验</p>
<p>方式一：web.xm中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里仅仅是声明了一个监听器，只要servletContext创建了就执行监听器里面的方法。 在方法里面要解析xml文件，然后完成工厂的创建工作。创建的applicationContext工厂对象存放在servletContext域对象中，通过WebApplicationContextUtils的getWebApplicationContext()方法获取到工厂对象。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">实际上，ContextLoaderListener实现了ServletContextListener接口，监听servletContext的创建和销毁--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式二：web.xml中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 最终目的是创建ContextLoaderServlet实例加载applicationContext.xml配置文件，创建Spring工厂</span></span><br><span class="line"><span class="comment">所以除了可以用监听器的方式，还可以手动提高ContextLoaderServlet实例化的优先级别，（级别1-5，数字越小，优先级别越高），这样项目部署完毕后就会实例化改对象</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>context<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		org.springframework.web.context.ContextLoaderServlet</span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="二、Struts2"><a href="#二、Struts2" class="headerlink" title="二、Struts2"></a>二、Struts2</h1><h3 id="2-1-Struts2的运行流程"><a href="#2-1-Struts2的运行流程" class="headerlink" title="2.1 Struts2的运行流程"></a>2.1 Struts2的运行流程</h3><h4 id="1-服务器启动-项目部署"><a href="#1-服务器启动-项目部署" class="headerlink" title="1.服务器启动(项目部署)"></a>1.服务器启动(项目部署)</h4><ul>
<li><p>当项目部署的时候,会执行StrutsPrepareAndExecuteFilter的init()方法,在init方法里面有这样的一行代码 :</p>
<p><code>dispatcher = init.initDispatcher(config);</code></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">init_DefaultProperties(); <span class="comment">// [1] —&gt; 加载 default.properties 常量配置(国际化编码, 文件上传的size...)</span></span><br><span class="line">init_TraditionalXmlConfigurations(); <span class="comment">// [2] -&gt;加载 struts-default.xml,struts-plugin.xml,struts.xml</span></span><br><span class="line">init_LegacyStrutsProperties(); <span class="comment">// [3] —&gt; 加载struts.properties</span></span><br><span class="line">init_CustomConfigurationProviders(); <span class="comment">// [5] ---&gt; 加载自定义的一些初始化类. 一般不写</span></span><br><span class="line">init_FilterInitParameters() ; <span class="comment">// [6]  ---&gt; 加载初始化参数。 initparam</span></span><br><span class="line">init_AliasStandardObjects() ; <span class="comment">// [7] ---&gt; 给对象起别名</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>图示</p>
<p>| 顺序   | 配置文件名              | 所在位置                                     | 说明         |<br>| —- | —————— | —————————————- | ———- |<br>| 1    | default.properties | ..src\core\src\main\resources\org\apache\struts2 | 不能修改       |<br>| 2    | struts-default.xml | ..\struts-2.3.32\src\core\src\main\resources | 不能修改       |<br>| 3    | strtuts-plugin.xml | 在struts2提供的插件jar包中，继承了struts-default的，新的包名为：json-default | 不能修改       |<br>| 4    | struts.xml         | 我们的应用中                                   | 我们修改的：推荐   |<br>| 5    | struts.properties  | 我们的应用中(当struts.xml用注解替代后，常量的修改就要创建这个文件来重新赋值，例如上传文件大小限制，国际化等) | 我们修改的:不建议用 |</p>
</li>
<li><p>后面配置的会把前面的覆盖</p>
<h4 id="2-配置文件加载-完成-顺序"><a href="#2-配置文件加载-完成-顺序" class="headerlink" title="2.配置文件加载(完成)顺序"></a>2.配置文件加载(完成)顺序</h4></li>
</ul>
<p>default.properties &gt; struts-default.xml &gt; struts-plugin.xml &gt; struts.xml &gt; struts.properties &gt; web.xml</p>
<p>####3.常量默认值</p>
<p>定义在default.properties中，可在struts.xml中进行重定义覆盖，或者在src下创建struts.properties中进行重新赋值覆盖默认值。</p>
<ul>
<li><p>常量举例</p>
<p>| 常量名                                   | 默认常量值    | 说明                                       |<br>| ————————————- | ——– | —————————————- |<br>| struts.i18n.encoding                  | UTF-8    | 应用中使用的编码                                 |<br>| struts.multipart.maxSize              | 2097152  | 文件上传总文件大小限制：2M                           |<br>| struts.action.extension               | action,, | 能进入Struts2框架内部的url地址后缀名。多个值用逗号分隔         |<br>| struts.enable.DynamicMethodInvocation | false    | 是否允许动态方法调用                               |<br>| struts.devMode                        | false    | 是否是开发模式。开发模式：改了配置文件，不需要重启。输出更多的错误信息。开发阶段建议为true。 |<br>| struts.ui.theme                       | xhtml    | 页面展示用的主题, struts2提供了四种主题simple、xhtml、css_xhtml、ajax。 |</p>
</li>
</ul>
<h3 id="2-2-result类型"><a href="#2-2-result类型" class="headerlink" title="2.2. result类型"></a>2.2. result类型</h3><ul>
<li><p>跳转页面：dispatcher(默认为转发), redirect(重定向)；</p>
</li>
<li><p>跳转Action：chain(转发)，redirectAction(重定向)；</p>
</li>
<li><p>返回json：json</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"test_*"</span> <span class="attr">class</span>=<span class="string">"com.itheima.testAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"returnJson"</span> <span class="attr">type</span>=<span class="string">"json"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--这里的name必须是root  至于这个user是我们在action里面的成员 变量user(属性),要有getter方法  --&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"root"</span>&gt;</span>user<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>文件下载：stream(很少用)</p>
<p>配置代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"demo01"</span> <span class="attr">class</span>=<span class="string">"com.itheima.web.action.ActionDemo01"</span> <span class="attr">method</span>=<span class="string">"fun01"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!--contentType:下载文件类型--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">     	<span class="comment">&lt;!--inputName:对应要输出到客户端流声明的名称,也就是说需要和Action里面声明的变量名要一致--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>stream<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--contentDisposition：下载到客户端时，客户端提示下载文件名称--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>attachment;filename="b.jpg"<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--bufferSize:读文件的缓存大小--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Action代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionDemo01</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> InputStream stream;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStream</span><span class="params">(InputStream stream)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.stream = stream;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stream;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">fun01</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo01 执行了..."</span>);</span><br><span class="line">		stream = <span class="keyword">new</span> FileInputStream(<span class="string">"E:/data/Desktop/a.jpg"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-3-OGNL表达式和ValueStack值栈"><a href="#2-3-OGNL表达式和ValueStack值栈" class="headerlink" title="2.3. OGNL表达式和ValueStack值栈"></a>2.3. OGNL表达式和ValueStack值栈</h3><ul>
<li><p>ognl全称：Object-Graph Navigation Language 对象图导航语言</p>
</li>
<li><p>ognl并不是struts创造的，它是一个开源项目，struts将它拿来作为自己的默认表达式语言</p>
</li>
<li><p>ognl的三大要素：表达式’&lt;s：property/&gt;’、根元素(root)、上下文(Context)</p>
</li>
<li><p>关系图示</p>
<p><img src="K:\黑马培训\就业班Web阶段\25期实录资料\SSH\day44Struts2三\笔记\img\tu_2.png" alt="tu_2"></p>
</li>
</ul>
<h5 id="1-Servlet和Action的区别"><a href="#1-Servlet和Action的区别" class="headerlink" title="1 Servlet和Action的区别"></a>1 Servlet和Action的区别</h5><ul>
<li><p>Servlet: Servlet只会创建一次实例，以后再过来请求，不会创建实例 </p>
</li>
<li><p>Action:  Action是多例，来一次请求就创建一次实例。 创建一次Action的实例，就创建一次ActionContext实例，并且就创建出来一个值栈的实例。</p>
</li>
</ul>
<h5 id="2-值栈的生命周期"><a href="#2-值栈的生命周期" class="headerlink" title="2. 值栈的生命周期"></a>2. 值栈的生命周期</h5><ul>
<li>接收到请求的时候就创建值栈实例OgnlValueStack，请求响应结束后就销毁了</li>
</ul>
<h5 id="3-获取值栈的方式"><a href="#3-获取值栈的方式" class="headerlink" title="3. 获取值栈的方式"></a>3. 获取值栈的方式</h5><ul>
<li>通过ActionContext：ActionContext.getContext().getValuestack();</li>
<li>通过request：ServletActionContext.getRequest().getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY)</li>
</ul>
<h5 id="4-值栈存值方式"><a href="#4-值栈存值方式" class="headerlink" title="4. 值栈存值方式"></a>4. 值栈存值方式</h5><ul>
<li><p>push：push方式是直接将值压到值栈栈顶，可以不用key直接通过ognl表达式取到栈顶的值，如果要取的不是栈顶的值，就要用[1].top.username(第二层)，[2].top.username(第三层),以此类推，top可以省略</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">等价于<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"[0].username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>set：set方式是将多个值存到map中，struts再将map用push方式存放到栈顶，取值则需要用key.username的方式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"user1.username"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性驱动：在Action中声明成员变量和对应的getter方法，在页面中直接根据变量名获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Action:</span><br><span class="line"><span class="keyword">private</span> String str;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStr</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line">##################################</span><br><span class="line">JSP:</span><br><span class="line">&lt;s:property value=<span class="string">"str"</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>模型驱动：Action继承特定的actionSupport后再实现ModelDriven<t>, 实现未实现的方法，即可在页面中获取该对象的属性，通过model.username或者直接用username取值。其底层实现原理是通过模型驱动的拦截器，将该模型对象push到值栈中了。</t></p>
</li>
</ul>
<h5 id="5-使用EL表达式获取值栈中的值"><a href="#5-使用EL表达式获取值栈中的值" class="headerlink" title="5. 使用EL表达式获取值栈中的值"></a>5. 使用EL表达式获取值栈中的值</h5><ul>
<li><p>EL表达式也可以取到值栈的值，本来EL表达式是用于取作用域的值，但是值栈和作用域是两个东西。 为什么EL 表达式也能去值栈的值呢？原因是 ： struts对EL 表达式取值的代码进行了扩展，如果从作用域取不到值就会去值栈找。</p>
<p>reuqest.setAttribute(“user” , user);   ${user.name} ——&gt; pageContext.findAttrbute();  –&gt; 先从page范围找(从小范围往大范围中去找)， 没有，就找request， 还没有就找session。request类型在struts框架中被包装成了 StrutsRequestWrapper ，在里面的getAttribute 做了判定，如果从作用域中取不到值，就去值栈取值，因为本身在struts框架中，request中就存了值栈对象。</p>
</li>
</ul>
<h5 id="6-OGNL的特殊符号："><a href="#6-OGNL的特殊符号：" class="headerlink" title="6.OGNL的特殊符号：#/$"></a>6.OGNL的特殊符号：#/$</h5><p>6.1#号的作用</p>
<ul>
<li><p>获取Context中的数据,非根对象里面的数据 </p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:property value=<span class="string">"#request.name"</span>/&gt;</span><br><span class="line">&lt;s:property value=<span class="string">"#session.name"</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建一个Map集合</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var变量会存一份到root也会存一份到上下文 c:foreach</span></span><br><span class="line">&lt;s:iterator var=<span class="string">"entry"</span> value=<span class="string">"#&#123; 'aa':'11','bb':'22','cc':'33' &#125;"</span>&gt; </span><br><span class="line">&lt;s:property value=<span class="string">"key"</span>/&gt;--&lt;s:property value=<span class="string">"value"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;s:property value=<span class="string">"#entry.key"</span>/&gt;--&lt;s:property value=<span class="string">"#entry.value"</span>/&gt;&lt;br/&gt;</span><br><span class="line">&lt;/s:iterator&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>6.2 $号的作用</p>
<ul>
<li>在xml等配置文件里面使用ognl,类似于EL表达式</li>
</ul>
<h3 id="2-4-拦截器-interceptor"><a href="#2-4-拦截器-interceptor" class="headerlink" title="2.4 拦截器(interceptor)"></a>2.4 拦截器(interceptor)</h3><blockquote>
<p>注:过滤器(Filter)可以过滤servlet，jsp,html , <strong>但拦截器只能拦截Action</strong></p>
</blockquote>
<h5 id="1-struts执行流程"><a href="#1-struts执行流程" class="headerlink" title="1. struts执行流程"></a>1. struts执行流程</h5><p>客户端请求Action，执行前端控制器，在前端控制器内部创建了Action的代理类，调用代理类的execute方法，在execute方法内部执行ActionInvocation的invoke方法。在invoke方法内部<strong>递归</strong>调用拦截器的拦截的方法。直到没有下一个拦截器，就执行目标Action，Action执行结束后根据Result进行页面跳转，执行拦截器的后面相应的代码，最后由response对象生成响应。</p>
<p>#####2. 自定义拦截器的三种方式</p>
<ul>
<li><p>实现interceptor接口，实现init, intercept, destroy方法，我们要拦截控制代码就是写在intercept方法里；init/destroy很少用</p>
</li>
<li><p>继承AbstractInterceptor，只需要实现intercept方法即可</p>
</li>
<li><p>继承MethodFilterInterceptor【重点】，只需要实现intercept方法，并且可以精准控制对Action的哪些方法进行拦截</p>
</li>
<li><p>在struts.xml的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--首先声明自定义的拦截器--&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"myInterceptor"</span> <span class="attr">value</span>=<span class="string">"自定义拦截器的全限定名"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--在Action中使用拦截器--&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user_*"</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myInterceptor"</span>&gt;</span> </span><br><span class="line">      		<span class="comment">&lt;!--不拦截fun02()方法 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"excludeMethods"</span>&gt;</span>fun02<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span> </span><br><span class="line">      <span class="comment">&lt;!--若拦截了也可以选择跳转页面或Action --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"unlogin"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：如果我们给自己的action使用了自己定义的拦截器，那么上面默认的这些拦截器都不会生效了，失去了这些功能，如果还想使用默认的这些拦截器。那么可以在action里面再引用它即可。</p>
</blockquote>
</li>
</ul>
<p>###2.5 Struts标签库</p>
<ul>
<li><p>引入标签库：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>常见标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:if</span>&gt;</span><span class="tag">&lt;/<span class="name">s:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:else</span>&gt;</span><span class="tag">&lt;/<span class="name">s:else</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">value</span>=<span class="string">"list"</span> <span class="attr">var</span>=<span class="string">"u"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>struts的form标签：自动加了样式, 标签都套了一层表格, 有自动回显数据的功能.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>二,Struts2的表单标签<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--默认请求方式就是post,action不用写项目路径  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:form</span> <span class="attr">action</span>=<span class="string">"/demo03_fun03"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">label</span>=<span class="string">"用户名"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:password</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">label</span>=<span class="string">"密码"</span>/&gt;</span></span><br><span class="line">	&lt;%-- &lt;s:radio list="&#123;'男','女'&#125;" name="sex" label="性别"/&gt; --%&gt;</span><br><span class="line">	<span class="tag">&lt;<span class="name">s:radio</span> <span class="attr">list</span>=<span class="string">"#&#123;'1':'男','0':'女' &#125;"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">label</span>=<span class="string">"性别"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:radio</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:checkboxlist</span> <span class="attr">list</span>=<span class="string">"&#123;'篮球','足球','乒乓球','敲代码'&#125;"</span> <span class="attr">label</span>=<span class="string">"爱好"</span> <span class="attr">name</span>=<span class="string">"hobby"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:select</span> <span class="attr">list</span>=<span class="string">"#&#123;'0':'北京','1':'上海','2':'深圳' &#125;"</span> <span class="attr">label</span>=<span class="string">"籍贯"</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">headerKey</span>=<span class="string">"-1"</span> <span class="attr">headerValue</span>=<span class="string">"请选择"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:textarea</span> <span class="attr">cols</span>=<span class="string">"8"</span> <span class="attr">rows</span>=<span class="string">"2"</span> <span class="attr">name</span>=<span class="string">"introduce"</span> <span class="attr">label</span>=<span class="string">"籍贯"</span> <span class="attr">value</span>=<span class="string">"哈哈"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textarea</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:submit</span> <span class="attr">value</span>=<span class="string">"注册"</span> <span class="attr">align</span>=<span class="string">"left"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>###2.6 国际化</p>
<ul>
<li><p>创建国际化资源.  在src下新建两个properties文件 ,  login_zh_CN.properties  login_en_US.properties. 命名规则是  <code>名字_语言_国家地区.properties</code>   注意：名字必须一致，只是后面的语言 &amp; 国家可以不同而已。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如： login_zh_CN.properties内容:</span><br><span class="line">		login.username=用户名</span><br><span class="line">		login.password=密码</span><br><span class="line">		login.submit=登录</span><br><span class="line"></span><br><span class="line">	login_en_US.properties的内容: </span><br><span class="line">		login.username=username</span><br><span class="line">		login.password=password</span><br><span class="line">		login.submit=submit</span><br></pre></td></tr></table></figure>
</li>
<li><p>告诉struts框架，使用这个国际化文件 ，配置手法,在struts.xml里面配置常量</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"login"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改页面内容</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href="$&#123;pageContext.request.contextPath &#125;/demo_fun01?request_locale=zh_CN"&gt;中文&lt;/a&gt;</span><br><span class="line">&lt;a href="$&#123;pageContext.request.contextPath &#125;/demo_fun01?request_locale=en_US"&gt;English&lt;/a&gt;</span><br><span class="line">&lt;!--这两个超链接是用来跳转到一个action，让struts 根据提交过去的request_locale 参数值来获取对应的properties文件内容,那个action里面没有什么实质性内容，只要返回success，然后还跳转到这个页面来即可。--&gt;</span><br><span class="line"></span><br><span class="line">&lt;s:form id=<span class="string">"loginform"</span> action=<span class="string">"/login"</span>&gt;</span><br><span class="line">     &lt;s:textfield name="username" key="login.username"&gt;&lt;/s:textfield&gt;</span><br><span class="line">     &lt;s:textfield name="password" key="login.password" &gt;&lt;/s:textfield&gt;</span><br><span class="line">     &lt;s:submit key="login.submit"&gt;&lt;/s:submit&gt;</span><br><span class="line">&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>### </p>
<h1 id="三、Hibernate"><a href="#三、Hibernate" class="headerlink" title="三、Hibernate"></a>三、Hibernate</h1><h3 id="3-1-简单描述"><a href="#3-1-简单描述" class="headerlink" title="3.1 简单描述"></a>3.1 简单描述</h3><ul>
<li>Hibernate应用于web应用持久层的框架，是对JDBC的封装。用于操作数据库，核心思想就是ORM:对象关系映射，通过配置bean.hbm.xml文件可以将数据库的表和对应的javaBean类产生关联，我们通过操作对象属性就能操作对应的数据库中的表数据，操作更加灵活。由此大大简化了持久层数据库访问的繁琐的代码。</li>
</ul>
<p>###3.2 Hibernate优点</p>
<ul>
<li><p>Hibernate对JDBC访问数据库的代码做了封装，大大简化了数据访问层繁琐的重复性代码</p>
</li>
<li><p>Hibernate是一个基于jdbc的主流持久化框架，是一个优秀的<strong>orm</strong>实现，它很大程度的简化了dao层编码工作</p>
</li>
<li><p>Hibernate的性能非常好，它是一个重量级框架。映射的灵活性很出色。它支持很多关系型数据库，从一对一到多对多的各种复杂关系    </p>
</li>
</ul>
<h3 id="3-3-映射配置文件bean-hbm-xml"><a href="#3-3-映射配置文件bean-hbm-xml" class="headerlink" title="3.3 映射配置文件bean.hbm.xml"></a>3.3 映射配置文件bean.hbm.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"> 	<span class="comment">&lt;!--一,class标签用于表示javaBean和表的映射关系: name是类名,table是表名   --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.itheima.bean.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line"> 		<span class="comment">&lt;!--1.id用来配置主键 :name是JavaBean里面的字段名,column是表里面的主键列名 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span></span><br><span class="line"> 			<span class="comment">&lt;!--1.1  generator主键生成策略 --&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> 		<span class="comment">&lt;!-- 2. 配置普通的字段对应关系,若属性名和列名一致，column可以不写 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"uname"</span> <span class="attr">column</span>=<span class="string">"uname"</span>/&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"uage"</span> <span class="attr">column</span>=<span class="string">"uage"</span>/&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3-3-1-主键策略类型-6种"><a href="#3-3-1-主键策略类型-6种" class="headerlink" title="3.3.1  主键策略类型(6种)"></a>3.3.1  主键策略类型(6种)</h5><ul>
<li>increment:自动增长，适用类型:short,int,long类型主键.在多进程和集群下不要使用.用的不是数据库的自动增长，    hibernate底层的增长策略，select max(id) from customer; 然后+1作为下一条记录的ID.</li>
<li>assigned:需要用户手动输入OID的.</li>
<li>identity:自动增长，用的是数据库的自动增长。适用类型:short,int,long类型主键.支持自动增长数据库如Mysql</li>
<li>sequence:序列，适用类型:short,int,long类型主键.支持序列的数据库如：Oracle.</li>
<li>native:本地策略，根据数据库的底层采用使用identity还是sequence.</li>
<li>uuid:随机的字符串，适用于字符串类型的主键.</li>
</ul>
<p>总结: 如果主键类型是int,short,long类型的时候用native</p>
<p>​     如果主键类型是字符串类型的时候, 用uuid</p>
<h3 id="3-4-核心配置文件hibernate-cfg-xml"><a href="#3-4-核心配置文件hibernate-cfg-xml" class="headerlink" title="3.4 核心配置文件hibernate.cfg.xml"></a>3.4 核心配置文件hibernate.cfg.xml</h3><p>Hibernate的核心类是configuration，当hibernate框架加载的时候，加载的第一个对象就是configuration，它会去找项目路径下的核心配置文件进行解析，创建出sessionFactory。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--一,必配项 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--1.1数据库的四个基本项 和 数据库方言--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate_day01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--二,选配项：显示sql语句，格式化sql语句，自动建表策略 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--三,加载映射关系配置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/itheima/bean/User.hbm.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-sql语言类型（四种）"><a href="#3-5-sql语言类型（四种）" class="headerlink" title="3.5 sql语言类型（四种）"></a>3.5 sql语言类型（四种）</h3><ul>
<li><p>DDL: Data Definition Language。数据库声明语言。</p>
<p>​使用了<code>CREATE</code>,<code>ALTER</code>,<code>DROP</code>,<code>TRUNCATE</code>,<code>COMMENT</code>,<code>RENAME</code>关键字。</p>
</li>
<li><p>DML：Data Manipulation Language。数据库操作语言。</p>
<p>​使用了<code>SELECT</code>,<code>INSERT</code>,<code>DELETE</code>,<code>UPDATE</code>关键字。</p>
</li>
<li><p>DCL: Data Control Language。数据库权限控制语言。</p>
<p>​使用了<code>GRANT</code>,<code>REVOKE</code>关键字。</p>
</li>
<li><p>TCL：Transaction Control Language。事务控制语言。</p>
<p>​使用了<code>SAVEPOINT</code>,<code>ROLLBACK</code>,<code>COMMIT</code>关键字。</p>
</li>
</ul>
<h3 id="3-6-核心类"><a href="#3-6-核心类" class="headerlink" title="3.6 核心类"></a>3.6 核心类</h3><h4 id="3-6-1-configuration"><a href="#3-6-1-configuration" class="headerlink" title="3.6.1 configuration"></a>3.6.1 configuration</h4><p>​    * 配置对象，用来加载Hibernate的主配置文件.</p>
<p>​    *Hibernate框架通过该对象来获得对象-关系映射文件中的元数据，以及动态配置Hibernate的属性。</p>
<p>​    *可以创建<code>SessionFactory</code>对象。</p>
<h4 id="3-6-2-SessionFactory"><a href="#3-6-2-SessionFactory" class="headerlink" title="3.6.2 SessionFactory"></a>3.6.2 <code>SessionFactory</code></h4><p><code></code>    *<code>SessionFactory</code>中相当于是连接池，内部获得Session.  </p>
<p>​    *<code>SessionFactory</code>并不是一个轻量级对象.  内部维护连接池和hibernate的二级缓存(企业很少用，redis).</p>
<p>​    *一个项目一般只需要创建一个<code>SessionFactory</code>.</p>
<p>####3.6.3 Session</p>
<p>​    *Session对象是Hibernate与数据库交互的桥梁,session对象里面封装了操作数据库的方法(添加,删除,查找,更新等)</p>
<p>​    *session不是线程安全的(使用时候,不能创建全局的).</p>
<p>​    *内部维护Hiberante的一级缓存，底层session接口包含一系列的 Java集合用于缓存数据(优化的手段).</p>
<p>#####3.6.3.1 get方法和load方法的区别【面试题】</p>
<blockquote>
<p>get方法的特点</p>
</blockquote>
<p>​    get方法采用的是立即检索策略(查询)：执行到这行的时候，马上发送SQL查询</p>
<p>​    get方法查询后返回的是真实对象的本身</p>
<blockquote>
<p>load方法的特点</p>
</blockquote>
<p>​    load方法采用的是延迟加载(懒加载lazy:什么时候使用，才会去加载)的策略：执行到这行的时候，不会发送SQL                        语句，什么时候使用这个对象，才会发送SQL语句。</p>
<p>​    load查询后返回的是代理对象</p>
<h4 id="3-6-4-Transaction"><a href="#3-6-4-Transaction" class="headerlink" title="3.6.4 Transaction"></a>3.6.4 Transaction</h4><p>​    *Hibernate框架默认情况下事务不自动提交.需要手动提交事务</p>
<p>​    *如果没有开启事务，那么每个Session的操作，都相当于一个独立的事务</p>
<p>​    *每段事务操作都是隐含着异常的，需要手动添加try catch</p>
<h3 id="3-7-Hibernate缓存"><a href="#3-7-Hibernate缓存" class="headerlink" title="3.7 Hibernate缓存"></a>3.7 Hibernate缓存</h3><h4 id="3-7-1-Hibernate的缓存类别"><a href="#3-7-1-Hibernate的缓存类别" class="headerlink" title="3.7.1.Hibernate的缓存类别"></a>3.7.1.Hibernate的缓存类别</h4><p>​    一级缓存：session对象的缓存，自带的不可卸载的.  一级缓存的生命周期与session一致。</p>
<p>​    二级缓存：二级缓存可以在多个session中共享数据。一般不会用,企业里通常使用Redis</p>
<h4 id="3-7-2-一级缓存"><a href="#3-7-2-一级缓存" class="headerlink" title="3.7.2.一级缓存"></a>3.7.2.一级缓存</h4><p>​    在 Session 接口的实现中包含一系列的 Java集合,这些 Java 集合构成了 Session 缓存. 只要 Session 实例没有结束生命周期, 存放在它缓存中的对象也不会结束生命周期.</p>
<p>​    当session的save()方法持久化一个对象时，该对象被载入缓存，以后即使程序中不再引用该对象，只要缓存不清空，该对象仍然处于生命周期中。当试图get()、 load()对象时，会判断缓存中是否存在该对象，有则返回，此时不查询数据库。没有再查询数据库</p>
<p>###3.8.Hibernate配置隔离级别</p>
<p>hibernate通过在hibernate.cfg.xml的配置文件中设置隔离级别:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=&quot;hibernate.connection.isolation&quot;&gt;4&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<p>取值</p>
<p>​    1: Read uncommitted isolation，读未提交</p>
<p>​    2: Read committed isolation，读已提交，解决脏读。(oracle默认)</p>
<p>​    4: Repeatable read isolation，可重复读(myql默认)</p>
<p>​    8: Serializable isolation，串行化(安全级别最高，效率低，银行系统)</p>
<h3 id="3-9-多表映射-xml-注解"><a href="#3-9-多表映射-xml-注解" class="headerlink" title="3.9 多表映射(xml,注解)"></a>3.9 多表映射(xml,注解)</h3><h4 id="3-9-1-一对多-分类-gt-商品"><a href="#3-9-1-一对多-分类-gt-商品" class="headerlink" title="3.9.1 一对多(分类-&gt;商品)"></a>3.9.1 一对多(分类-&gt;商品)</h4><h5 id="级联"><a href="#级联" class="headerlink" title="级联"></a>级联</h5><blockquote>
<p> cascade=”save-update,delete”</p>
</blockquote>
<h5 id="一方放弃外键维护"><a href="#一方放弃外键维护" class="headerlink" title="一方放弃外键维护"></a>一方放弃外键维护</h5><ul>
<li>一旦存在主外键关系，那么外键就由双方对象去维护了， 那么就会造成对这个外键执行了多次操作， 造成重复sql查询，有一次操作其实可以避免的。 也就是说这个外键只要让一个人去维护即可。  外键属于谁，就让谁去维护。</li>
</ul>
<blockquote>
<p>inverse=”true”</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.itheima.bean.Category"</span> <span class="attr">table</span>=<span class="string">"t_category"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--一,主键属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cid"</span> <span class="attr">column</span>=<span class="string">"cid"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 二,其它属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cname"</span> <span class="attr">column</span>=<span class="string">"cname"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 三,表示和商品的关系 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--3.1 set标签的name属性:多的一方的集合的名字  --&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!--cascade="save-update,delete"级联属性表示保存或删除一方的时候，</span></span><br><span class="line"><span class="comment">		关联的多方也同时保存或者删除--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"products"</span> <span class="attr">cascade</span>=<span class="string">"save-update,delete"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--3.2 key的 column表示多的一方外键名 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cid"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--3.3 one-to-many的class属性表示多的一方类的全限定名  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.itheima.bean.Product"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_category"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer cid;</span><br><span class="line">	<span class="keyword">private</span> String cname;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Product&gt; products = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCid</span><span class="params">(Integer cid)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cid = cid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCname</span><span class="params">(String cname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cname = cname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//mappedBy表明外键由另外一方维护</span></span><br><span class="line">	<span class="meta">@OneToMany</span>(mappedBy=<span class="string">"category"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> products;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(Set&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.products = products;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-9-2-多对一-商品-gt-分类"><a href="#3-9-2-多对一-商品-gt-分类" class="headerlink" title="3.9.2 多对一(商品-&gt;分类)"></a>3.9.2 多对一(商品-&gt;分类)</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.itheima.bean.Product"</span> <span class="attr">table</span>=<span class="string">"t_product"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--一,主键属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"pid"</span> <span class="attr">column</span>=<span class="string">"pid"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 二,其它属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pname"</span> <span class="attr">column</span>=<span class="string">"pname"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">column</span>=<span class="string">"price"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 三,表示和分类的关系 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--3.1name:一的一方对象的名字</span></span><br><span class="line"><span class="comment">			  class: 一的一方类的全限定名</span></span><br><span class="line"><span class="comment">			  column:外键的名字</span></span><br><span class="line"><span class="comment">		  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"category"</span> <span class="attr">class</span>=<span class="string">"com.itheima.bean.Category"</span> <span class="attr">column</span>=<span class="string">"cid"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_product"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer pid;</span><br><span class="line">	<span class="keyword">private</span> String pname;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Category category;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String pname, <span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.pname = pname;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getPid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPid</span><span class="params">(Integer pid)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pid = pid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPname</span><span class="params">(String pname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pname = pname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Category <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> category;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.category = category;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-9-3-多对多-学生选课例"><a href="#3-9-3-多对多-学生选课例" class="headerlink" title="3.9.3 多对多(学生选课例)"></a>3.9.3 多对多(学生选课例)</h4><ul>
<li><p>多对多都是有一个中间表进行关联的，映射关系可以有两种表现形式：多对多，由系统生成第三张中间表；拆分成两个一对多，自己创建一个类多对一关联学生表和课程表。</p>
</li>
<li><p>如果多对多双向关联,一定要一方<strong>放弃主键维护</strong>，否则就会出现主键冲突，在中间表重复插入同一条数据。</p>
</li>
<li><p>注意的地方:</p>
<p>​    非级联删除只会删除正向多方数据库表和中间关系表中的记录，不会删除反向多方表中的记录</p>
<p>​    级联删除既会删除正向多方数据库表中的记录，也会删除反向多方表中的记录和中间关系表中的记录</p>
<p>​    开发过程中用的比较少</p>
</li>
</ul>
<p>多对多映射xml：</p>
<p>学生表映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.itheima.bean.Student"</span> <span class="attr">table</span>=<span class="string">"t_student"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--一,主键属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"sid"</span> <span class="attr">column</span>=<span class="string">"sid"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 二,其它属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sname"</span> <span class="attr">column</span>=<span class="string">"sname"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 三,表示和课程的关系 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--3.1 set标签的name属性:当前类中集合的名字 </span></span><br><span class="line"><span class="comment">				table:第三方表名</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"courses"</span> <span class="attr">table</span>=<span class="string">"s_c_tab"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--3.2 key的 column表示当前类在中间表中的外键 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"sid"</span> /&gt;</span></span><br><span class="line">				<span class="comment">&lt;!--3.3 many-to-many表示多对多关系</span></span><br><span class="line"><span class="comment">			  		column:表示另一方在中间表中的外键</span></span><br><span class="line"><span class="comment">			  		class:表示另一方类的全限定名</span></span><br><span class="line"><span class="comment">			  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">column</span>=<span class="string">"cid"</span> <span class="attr">class</span>=<span class="string">"com.itheima.bean.Course"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer sid;</span><br><span class="line">	<span class="keyword">private</span> String sname;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Course&gt; courses = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String sname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sname = sname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">  	<span class="comment">/*	</span></span><br><span class="line"><span class="comment">  	如果主键是字符串类型，那么就要声明主键生成策略是uuid</span></span><br><span class="line"><span class="comment">  	@Id</span></span><br><span class="line"><span class="comment">	@GeneratedValue(generator="producttableGenerator")</span></span><br><span class="line"><span class="comment">	@GenericGenerator(name="producttableGenerator",strategy="uuid")*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getSid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSid</span><span class="params">(Integer sid)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sid = sid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSname</span><span class="params">(String sname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sname = sname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@ManyToMany</span></span><br><span class="line">	<span class="meta">@JoinTable</span>(name=<span class="string">"t_stu_cou"</span>, <span class="comment">//中间表表名</span></span><br><span class="line">		joinColumns=&#123;<span class="meta">@JoinColumn</span>(name=<span class="string">"sid"</span>)&#125;, <span class="comment">//当前类对应中间表中的外键名</span></span><br><span class="line">		inverseJoinColumns=&#123;<span class="meta">@JoinColumn</span>(name=<span class="string">"cid"</span>)&#125;<span class="comment">//另一方对应中间表的外键名</span></span><br><span class="line">			)</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Course&gt; <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courses;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(Set&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courses = courses;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>课程表映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.itheima.bean.Course"</span> <span class="attr">table</span>=<span class="string">"t_course"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--一,主键属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cid"</span> <span class="attr">column</span>=<span class="string">"cid"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 二,其它属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cname"</span> <span class="attr">column</span>=<span class="string">"cname"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 三,表示和课程的关系 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--3.1 set标签的name属性:当前类中集合的名字  </span></span><br><span class="line"><span class="comment">			table:第三方表名</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"students"</span> <span class="attr">table</span>=<span class="string">"s_c_tab"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--3.2 key的 column表示当前类在中间表中的外键 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cid"</span>/&gt;</span></span><br><span class="line">				<span class="comment">&lt;!--3.3 many-to-many表示多对多关系</span></span><br><span class="line"><span class="comment">			  		column:表示另一方在中间表中的外键</span></span><br><span class="line"><span class="comment">			  		class:表示另一方类的全限定名</span></span><br><span class="line"><span class="comment">			  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">column</span>=<span class="string">"sid"</span> <span class="attr">class</span>=<span class="string">"com.itheima.bean.Student"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_course"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer cid;</span><br><span class="line">	<span class="keyword">private</span> String cname;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Student&gt; students = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Course [cid="</span> + cid + <span class="string">", cname="</span> + cname + <span class="string">", students="</span> + students + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Course</span><span class="params">(String cname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.cname = cname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCid</span><span class="params">(Integer cid)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cid = cid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cname;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCname</span><span class="params">(String cname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cname = cname;</span><br><span class="line">	&#125;</span><br><span class="line">  	<span class="comment">//表明由另一方维护外键</span></span><br><span class="line">	<span class="meta">@ManyToMany</span>(mappedBy=<span class="string">"courses"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudents</span><span class="params">(Set&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.students = students;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-0-Hibernate查询"><a href="#4-0-Hibernate查询" class="headerlink" title="4.0 Hibernate查询"></a>4.0 Hibernate查询</h3><h4 id="4-0-1-HQL查询"><a href="#4-0-1-HQL查询" class="headerlink" title="4.0.1 HQL查询"></a>4.0.1 HQL查询</h4><p>#####基本查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"form Category"</span>  等价于 String sql = <span class="string">"select * from t_category"</span></span><br><span class="line">HQL于与sql的不同之处在于操作对象的变换，原生sql是直接操作表，而hql操作的是对象。</span><br><span class="line">表名(sql)对应的是javaBean对象的名字(hql)</span><br><span class="line">列名(sql)对应的是javaBean的属性(hql)</span><br><span class="line">  </span><br><span class="line">hql条件查询/条件赋值：</span><br><span class="line">String hql = <span class="string">"from Category where cid = ?"</span>;</span><br><span class="line">或者：String hql = <span class="string">"from Category where cid = :类别id"</span>;</span><br><span class="line">Query query = session.creatQuery(hql);</span><br><span class="line"></span><br><span class="line">query.setInteger(<span class="number">0</span>,<span class="number">1</span>);<span class="comment">//注意：jdbc中的prepareStatement的set赋值是从下标1开始的</span></span><br><span class="line">或者：query.setInteger(<span class="string">"类别id"</span>,<span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line">List list = query.list();</span><br></pre></td></tr></table></figure>
<h5 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select count(*) from Category"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">Long n =  (Long) query.uniqueResult();</span><br><span class="line">System.out.println(n.intValue());</span><br></pre></td></tr></table></figure>
<h5 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h5><p>统计各个类别的商品数量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select category.cid, count(*) from Product group by category.cid"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Object[]&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">	System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h5><p>安照商品价格(升序)查询所有的商品</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from Product order by price asc"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Product&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Product product : list) &#123;</span><br><span class="line">	System.out.println(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h5><p>​    注意：limit a,b是mysql的分页查询方言，hql没有这个语言，它的分页通过如下API实现的。</p>
<p>​    setFirstResult:设置开始查询的下标，最小取值是0，0代表第一条记录</p>
<p>​    setMaxResults: 设置查询结果显示的条数。</p>
<p>显示第一页的数据,一页显示4条</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from Product"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">query.setMaxResults(<span class="number">4</span>);</span><br><span class="line">List&lt;Product&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Product product : list) &#123;</span><br><span class="line">		System.out.println(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a>投影查询</h5><p>查询指定字段; </p>
<p>查询商品的名字和价格</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"select pname, price from Product"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Object[]&gt; list =  query.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">	System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#### </p>
<h4 id="4-0-2-QBC查询"><a href="#4-0-2-QBC查询" class="headerlink" title="4.0.2 QBC查询"></a>4.0.2 QBC查询</h4><h5 id="基本查询语法"><a href="#基本查询语法" class="headerlink" title="基本查询语法"></a>基本查询语法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建QBC条件查询</span></span><br><span class="line">Criteria criteria = session.createCriteria(Class);</span><br><span class="line"><span class="comment">//添加条件</span></span><br><span class="line">criteria.add(Restrictions.api...);</span><br><span class="line"><span class="comment">//查询多个</span></span><br><span class="line">List list = criteria.list();</span><br><span class="line"><span class="comment">//或者查询一个</span></span><br><span class="line">Object object =  criteria.uniqueResult();</span><br></pre></td></tr></table></figure>
<h5 id="聚合查询-1"><a href="#聚合查询-1" class="headerlink" title="聚合查询"></a>聚合查询</h5><p>sum(),count(),max(),min(),avg()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建QBC条件查询</span></span><br><span class="line">Criteria criteria = session.createCriteria(Class);</span><br><span class="line"><span class="comment">//设置聚合</span></span><br><span class="line">criteria.setProjection(Projections.api...);</span><br><span class="line"><span class="comment">//查询出结果</span></span><br><span class="line"><span class="keyword">long</span> result = (<span class="keyword">long</span>) criteria.uniqueResult();</span><br></pre></td></tr></table></figure>
<h5 id="多项聚合"><a href="#多项聚合" class="headerlink" title="多项聚合"></a>多项聚合</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建QBC条件查询</span></span><br><span class="line">Criteria criteria = session.createCriteria(Class);</span><br><span class="line"><span class="comment">//添加多种聚合</span></span><br><span class="line">ProjectionList list = Projections.projectionList();</span><br><span class="line">list.add(Projections.api...);</span><br><span class="line">...</span><br><span class="line"><span class="comment">//设置聚合</span></span><br><span class="line">criteria.setProjection(list);</span><br><span class="line"><span class="comment">//查询出结果</span></span><br><span class="line">Object[] result = (Object[]) criteria.uniqueResult();</span><br></pre></td></tr></table></figure>
<h5 id="排序查询-1"><a href="#排序查询-1" class="headerlink" title="排序查询"></a>排序查询</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建QBC条件查询</span></span><br><span class="line">Criteria criteria = session.createCriteria(Class);</span><br><span class="line"><span class="comment">//添加排序</span></span><br><span class="line">criteria.addOrder(Order.api...);</span><br><span class="line"><span class="comment">//查询出结果</span></span><br><span class="line">List list = criteria.list();</span><br></pre></td></tr></table></figure>
<h5 id="分页查询-1"><a href="#分页查询-1" class="headerlink" title="分页查询"></a>分页查询</h5><ul>
<li>setFirstResult:设置开始查询的下标，最小取值是0，0代表第一条记录  设置a</li>
<li>setMaxResults: 设置查询结果显示的条数。   设置 b</li>
</ul>
<h5 id="离线查询"><a href="#离线查询" class="headerlink" title="离线查询"></a>离线查询</h5><ul>
<li>脱离session对条件查询语句在web层或者service层进行封装，可以在dao层统一用DetachedCriteria进行接收，提高代码复用性。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建离线的DetachedCriteria对象</span></span><br><span class="line">DetachedCriteria detachedCriteria = DetachedCriteria.forClass(User.class);</span><br><span class="line"><span class="comment">//设置条件</span></span><br><span class="line">detachedCriteria.add(Restrictions.like(<span class="string">"u_name"</span>, <span class="string">"%奥%"</span>));</span><br><span class="line"> <span class="comment">//转成</span></span><br><span class="line"> Criteria criteria = detachedCriteria.getExecutableCriteria(session);</span><br><span class="line"> List&lt;User&gt; list = criteria.list();</span><br></pre></td></tr></table></figure>
<h4 id="4-0-3-连接查询"><a href="#4-0-3-连接查询" class="headerlink" title="4.0.3 连接查询"></a>4.0.3 连接查询</h4><h5 id="HQL内连接查询"><a href="#HQL内连接查询" class="headerlink" title="HQL内连接查询"></a>HQL内连接查询</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String hql = <span class="string">"from Category c inner join c.products"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Object[]&gt; list =  query.list();<span class="comment">//查出所有pid=cid的Category信息和Product信息</span></span><br></pre></td></tr></table></figure>
<p>#####HQL迫切内连接查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//String hql = "from Category c inner join fetch c.products"; 返回的是查出所有pid=cid的Category信息，但是有重复</span></span><br><span class="line">String hql = <span class="string">"select distinct c from Category c inner  join fetch c.products"</span>;<span class="comment">//去重</span></span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line">List&lt;Category&gt; list =  query.list();</span><br></pre></td></tr></table></figure>
<ul>
<li>迫切连接是Hibernate独有的查询方式,迫切内连接比内连接多一个关键字fetch</li>
</ul>
<ul>
<li>内连接查询结果中为<code>Object[]</code>数组</li>
</ul>
<ul>
<li>迫切内连接查询结果为<code>具体对象</code></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/06/SSH框架/" data-id="cjgul7oxw000018kbpcxe8ajs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/05/06/“博客名”/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">“博客名”</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/05/06/SSH框架/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/05/06/“博客名”/">“博客名”</a>
          </li>
        
          <li>
            <a href="/2018/05/06/Hexo”/">Hexo”</a>
          </li>
        
          <li>
            <a href="/2018/05/06/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>